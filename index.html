<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Constructeur de Phrases</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .page {
            display: none;
            background-color: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .page.active {
            display: block;
        }
        
        /* PAGE 1 - HISTOIRE */
        #story-page {
            text-align: center;
        }
        
        .story-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 30px;
            margin: 30px auto;
        }
        
        #story-image-large {
            max-width: 500px;
            max-height: 400px;
            border: 5px solid #4a90e2;
            border-radius: 20px;
            object-fit: contain;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .audio-button-large {
            background: linear-gradient(45deg, #ff6b6b, #ff8e8e);
            border: none;
            border-radius: 50%;
            width: 80px;
            height: 80px;
            cursor: pointer;
            font-size: 30px;
            color: white;
            box-shadow: 0 6px 15px rgba(255, 107, 107, 0.4);
            transition: all 0.3s ease;
        }
        
        .audio-button-large:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 20px rgba(255, 107, 107, 0.6);
        }
        
        .start-button {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            color: white;
            border: none;
            padding: 20px 40px;
            font-size: 24px;
            border-radius: 50px;
            cursor: pointer;
            margin-top: 30px;
            box-shadow: 0 6px 15px rgba(78, 205, 196, 0.4);
            transition: all 0.3s ease;
            font-weight: bold;
        }
        
        .start-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(78, 205, 196, 0.6);
        }
        
        /* PAGE 2 - CONSTRUCTION */
        #construction-page {
            position: relative;
        }
        
        .story-reminder {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            background-color: #f0f8ff;
            padding: 10px;
            border-radius: 15px;
            border: 2px solid #4a90e2;
        }
        
        #story-image-small {
            width: 80px;
            height: 60px;
            border: 2px solid #4a90e2;
            border-radius: 8px;
            object-fit: contain;
        }
        
        .audio-button-small {
            background-color: #ff6b6b;
            border: none;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            cursor: pointer;
            font-size: 14px;
            color: white;
        }
        
        .sentence-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin: 50px 0;
            flex-wrap: wrap;
        }
        
        .word-cell {
            width: 150px;
            height: 150px;
            border: 4px solid #ccc;
            border-radius: 15px;
            background-color: white;
            position: relative;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        
        .word-cell:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }
        
        .word-cell.selected {
            border-color: #4caf50;
            box-shadow: 0 0 20px rgba(76, 175, 80, 0.5);
            transform: translateY(-5px);
        }
        
        .word-cell img {
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
        }
        
        .color-indicator {
            position: absolute;
            bottom: 8px;
            right: 8px;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        
        .yellow { background-color: #ffeb3b; }
        .blue { background-color: #2196f3; }
        .red { background-color: #f44336; }
        
        .delete-btn {
            position: absolute;
            top: -10px;
            right: -10px;
            background-color: #f44336;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            font-size: 16px;
            cursor: pointer;
            display: none;
            font-weight: bold;
        }
        
        .word-cell:hover .delete-btn {
            display: block;
        }
        
        .read-button {
            background: linear-gradient(45deg, #4caf50, #45a049);
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            cursor: pointer;
            font-size: 24px;
            color: white;
            box-shadow: 0 4px 10px rgba(76, 175, 80, 0.4);
            transition: all 0.3s ease;
        }
        
        .read-button:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 15px rgba(76, 175, 80, 0.6);
        }
        
        /* Section sÃ©lection d'images */
        .selection-section {
            background-color: #e8f5e9;
            padding: 20px;
            border-radius: 15px;
            margin: 30px 0;
            border: 2px solid #4caf50;
        }
        
        .image-grid {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }
        
        .selectable-image {
            width: 90px;
            height: 90px;
            border: 3px solid #ccc;
            border-radius: 10px;
            cursor: pointer;
            object-fit: contain;
            background-color: white;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .selectable-image:hover {
            transform: scale(1.1);
            border-color: #4caf50;
            box-shadow: 0 4px 10px rgba(76, 175, 80, 0.3);
        }
        
        /* Boutons de contrÃ´le */
        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
        }
        
        .control-button {
            padding: 15px 30px;
            font-size: 18px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }
        
        .next-button {
            background: linear-gradient(45deg, #4a90e2, #357abd);
            color: white;
            box-shadow: 0 4px 10px rgba(74, 144, 226, 0.4);
        }
        
        .next-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(74, 144, 226, 0.6);
        }
        
        .clear-button {
            background: linear-gradient(45deg, #ff9800, #f57c00);
            color: white;
            box-shadow: 0 4px 10px rgba(255, 152, 0, 0.4);
        }
        
        .clear-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(255, 152, 0, 0.6);
        }
        
        .instructions {
            color: #666;
            font-style: italic;
            margin-bottom: 15px;
            font-size: 16px;
        }
        
        h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 24px;
        }
    </style>
</head>
<body>
            <!-- PAGE 1 - HISTOIRE -->
    <div id="story-page" class="page active">
        <div class="story-container">
            <img id="story-image-large" src="" alt="Image de l'histoire">
            <button id="story-audio-large" class="audio-button-large">ðŸ”Š</button>
        </div>
        <button id="start-construction" class="start-button">âœ¨ Construire ma phrase âœ¨</button>
    </div>
    
    <!-- PAGE 2 - CONSTRUCTION -->
    <div id="construction-page" class="page">
        <div class="story-reminder">
            <img id="story-image-small" src="" alt="Rappel histoire">
            <button id="story-audio-small" class="audio-button-small">ðŸ”Š</button>
        </div>
        
        <div class="sentence-container">
            <div class="word-cell" data-color="yellow" data-position="0">
                <div class="color-indicator yellow"></div>
            </div>
            <div class="word-cell" data-color="blue" data-position="1">
                <div class="color-indicator blue"></div>
            </div>
            <div class="word-cell" data-color="red" data-position="2">
                <div class="color-indicator red"></div>
            </div>
            <div class="word-cell" data-color="yellow" data-position="3">
                <div class="color-indicator yellow"></div>
            </div>
            <div class="word-cell" data-color="blue" data-position="4">
                <div class="color-indicator blue"></div>
            </div>
            <button id="read-sentence" class="read-button">ðŸ”Š</button>
        </div>
        
        <div class="selection-section">
            <h2>Choisis tes images</h2>
            <p class="instructions">Clique sur une case colorÃ©e puis sur une image</p>
            <div id="image-grid" class="image-grid"></div>
        </div>
        
        <div class="controls">
            <button id="clear-sentence" class="control-button clear-button">Effacer la phrase</button>
            <button id="next-story" class="control-button next-button">Histoire suivante</button>
        </div>
    </div>
    
    <script>
        // Configuration
        const totalStories = 10;
        const imagesByColor = {
            yellow: 5,
            red: 10,
            blue: 20
        };
        
        // Ã‰tat de l'application
        let currentStory = 1;
        let selectedCell = null;
        let sentenceImages = [null, null, null, null, null];
        
        // Ã‰lÃ©ments DOM
        const storyPage = document.getElementById('story-page');
        const constructionPage = document.getElementById('construction-page');
        const storyImageLarge = document.getElementById('story-image-large');
        const storyImageSmall = document.getElementById('story-image-small');
        const storyAudioLarge = document.getElementById('story-audio-large');
        const storyAudioSmall = document.getElementById('story-audio-small');
        const startConstructionBtn = document.getElementById('start-construction');
        const wordCells = document.querySelectorAll('.word-cell');
        const imageGrid = document.getElementById('image-grid');
        const readSentenceBtn = document.getElementById('read-sentence');
        const clearSentenceBtn = document.getElementById('clear-sentence');
        const nextStoryBtn = document.getElementById('next-story');
        
        // Fonction pour charger une histoire
        function loadStory(storyNumber) {
            const imagePath = `images/hist${storyNumber}.jpeg`;
            storyImageLarge.src = imagePath;
            storyImageSmall.src = imagePath;
            storyImageLarge.alt = `Histoire ${storyNumber}`;
            storyImageSmall.alt = `Histoire ${storyNumber}`;
        }
        
        // Fonction pour jouer un son
        function playSound(soundPath) {
            const audio = new Audio(soundPath);
            audio.play().catch(error => {
                console.log('Erreur lors de la lecture du son:', error);
            });
        }
        
        // Fonction pour changer de page
        function showPage(pageToShow) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            pageToShow.classList.add('active');
        }
        
        // Fonction pour afficher les images d'une couleur
        function showImagesForColor(color) {
            imageGrid.innerHTML = '';
            const count = imagesByColor[color];
            const colorPrefix = color === 'yellow' ? 'jau' : 
                              color === 'red' ? 'rou' : 'bleu';
            
            for (let i = 1; i <= count; i++) {
                const img = document.createElement('img');
                img.src = `images/${colorPrefix}${i}.jpeg`;
                img.className = 'selectable-image';
                img.dataset.imageName = `${colorPrefix}${i}`;
                
                img.addEventListener('click', () => {
                    if (selectedCell !== null) {
                        placeImageInCell(selectedCell, img.src, img.dataset.imageName);
                        clearSelection();
                    }
                });
                
                imageGrid.appendChild(img);
            }
        }
        
        // Fonction pour placer une image dans une cellule
        function placeImageInCell(cellIndex, imageSrc, imageName) {
            const cell = wordCells[cellIndex];
            
            // Nettoyer la cellule
            const existingImg = cell.querySelector('img:not(.color-indicator)');
            const existingBtn = cell.querySelector('.delete-btn');
            if (existingImg) existingImg.remove();
            if (existingBtn) existingBtn.remove();
            
            // Ajouter la nouvelle image
            const img = document.createElement('img');
            img.src = imageSrc;
            cell.appendChild(img);
            
            // Ajouter le bouton de suppression
            const deleteBtn = document.createElement('button');
            deleteBtn.className = 'delete-btn';
            deleteBtn.textContent = 'Ã—';
            deleteBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                removeImageFromCell(cellIndex);
            });
            cell.appendChild(deleteBtn);
            
            // Sauvegarder dans l'Ã©tat
            sentenceImages[cellIndex] = imageName;
        }
        
        // Fonction pour supprimer une image d'une cellule
        function removeImageFromCell(cellIndex) {
            const cell = wordCells[cellIndex];
            const img = cell.querySelector('img:not(.color-indicator)');
            const deleteBtn = cell.querySelector('.delete-btn');
            
            if (img) img.remove();
            if (deleteBtn) deleteBtn.remove();
            
            sentenceImages[cellIndex] = null;
        }
        
        // Fonction pour effacer la sÃ©lection
        function clearSelection() {
            wordCells.forEach(cell => cell.classList.remove('selected'));
            selectedCell = null;
            imageGrid.innerHTML = '';
        }
        
        // Fonction pour lire la phrase
        function readSentence() {
            const validImages = sentenceImages.filter(img => img !== null);
            if (validImages.length === 0) {
                alert('Ajoute des images Ã  ta phrase pour la lire !');
                return;
            }
            
            let delay = 0;
            sentenceImages.forEach(imageName => {
                if (imageName) {
                    setTimeout(() => {
                        playSound(`sons/${imageName}.mp3`);
                    }, delay);
                    delay += 1000;
                }
            });
        }
        
        // Fonction pour effacer la phrase
        function clearSentence() {
            wordCells.forEach((cell, index) => {
                removeImageFromCell(index);
            });
            clearSelection();
        }
        
        // Fonction pour passer Ã  l'histoire suivante
        function nextStory() {
            currentStory = currentStory >= totalStories ? 1 : currentStory + 1;
            loadStory(currentStory);
            clearSentence();
            showPage(storyPage);
        }
        
        // Gestionnaires d'Ã©vÃ©nements
        storyAudioLarge.addEventListener('click', () => {
            playSound(`sons/hist${currentStory}.mp3`);
        });
        
        storyAudioSmall.addEventListener('click', () => {
            playSound(`sons/hist${currentStory}.mp3`);
        });
        
        startConstructionBtn.addEventListener('click', () => {
            showPage(constructionPage);
        });
        
        wordCells.forEach((cell, index) => {
            cell.addEventListener('click', () => {
                clearSelection();
                cell.classList.add('selected');
                selectedCell = index;
                
                const color = cell.dataset.color;
                showImagesForColor(color);
            });
        });
        
        readSentenceBtn.addEventListener('click', readSentence);
        clearSentenceBtn.addEventListener('click', clearSentence);
        nextStoryBtn.addEventListener('click', nextStory);
        
        // Initialisation
        loadStory(currentStory);
    </script>
</body>
</html>
